{
  "name": "hello",
  "components": [
    {
      "type": "stage",
      "name": "check-store",
      "service": {"name": "kv-store", "function": "get"},
      "prepare": {"key":  "args['name']"},
      "transform": {"greeted": "args"}
    },
    {
      "type": "switch",
      "condition": "if args['greeted']['value'], do: \"yes\", else: \"no\"",
      "branches": {
        "yes": [
          {
            "type": "stage",
            "name": "no-greetings",
            "service": {"name": "greeter", "function": "no_greet"},
            "prepare": {"name":  "args['name']"},
            "transform": {"message":  "args['message']"}
          }
        ],
        "no": [
          {
            "type": "stage",
            "name": "do-greet",
            "service": {"name": "greeter", "function": "greet"},
            "prepare": {"name":  "args['name']"},
            "transform": {"message":  "args['message']"}
          },
          {
            "type": "stage",
            "name": "save-to-store",
            "service": {"name": "kv-store", "function": "set"},
            "prepare": {"key":  "args['name']", "value": true}
          }
        ]
      }
    }
  ]
}
